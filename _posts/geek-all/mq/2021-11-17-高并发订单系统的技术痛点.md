---
layout: post 
author: oshacker
title: 高并发订单系统架构及技术痛点
category: mq
tags: [geek,mq]
excerpt: 第二篇
---

## 高并发订单系统架构及技术痛点

## 订单系统的核心业务流程

我们在APP中购买商品时，首先会在APP中浏览各种各样的商品，接着将喜欢的商品加入到购物车，下订单、支付就完成了购买流程，然后商品配送等，这个过程中涉及的系统如下图：

<img src="https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20211117073111992.png" alt="image-20211117073111992" style="zoom:80%;" />

从上图可知，在整个电商购物流程中，订单系统是非常关键的一环，通常也是公司最核心的业务之一。

在订单系统中，最核心的业务流程应该是下订单，流程如下图：

<img src="https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20211117104630265.png" alt="image-20211117104630265" style="zoom:80%;" />

+ 用户对购物车中选中的一批商品进行结算（点击【去结算】按钮）
+ 跳转到确认订单信息页面（确认这个订单中的商品、价格、运费；选择是否使用优惠券、促销活动；确认收件地址、配送方式、是否开发票以及发票抬头等）
+ 用户完成订单信息确认，就可以正式下单（点击【提交订单】按钮）

接下来是订单系统最核心的环节，会做两个事：

+ 根据APP端传递过来的各种信息，完成订单的创建，在数据库中创建对应的订单记录；
+ 跳转到支付收银台（用户选择付款方式），并完成订单支付（按指定付款方式完成付款）

<img src="https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20211117111359687.png" alt="image-20211117111359687" style="zoom:80%;" />

支付完成后，第三方支付渠道（微信、支付宝等）会回调我们的一个接口，通知我们本次支付已经成功。我们收到支付成功的通知后，我们也会做两件事：

+ 调用订单系统给用户发放优惠券、红包、向用户push支付成功准备收货的消息等
+ 调用配送系统给用户安排发货配送

<img src="https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20211117112400445.png" alt="image-20211117112400445" style="zoom:80%;" />

## 订单系统的非核心业务流程









