---
layout: post 
author: oshacker
title: 生产问题排查记录
category: prod
tags: [prod]
excerpt: 第一篇
---

\## 排查了半天原来是磁盘满了

现象：系统卡顿（比如登陆响应了半天才进去，查询也很卡），但是系统又没挂掉（进程还在）

\```shell

df -h

\```

一般查看/dev/vda1的使用率，如果发现磁盘使用达到99.x%，即磁盘满了，系统运行时无法再写入日志或写入很慢。接下来，定位具体是哪个目录占用了大量的磁盘空间。

\```shell

du -h --max-depth=2 /usr 其中，/usr表示从哪个目录查找

du --block-size=MB --max-depth=2 /usr | sort -n -r -k1 | head -n5

其中，

--block-size：统一单位方便sort；

-n：按数字方式排序；

-r：表示倒序

-k1：表示按第一列排序

\```

如果最终发现是日志占用了大量的磁盘空间，临时的方案是手动删除过期的日志，也可以在Spring Boot的logback中定义滚动日志，设置保存多久的日志。

