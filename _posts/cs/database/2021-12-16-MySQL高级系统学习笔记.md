---
layout: post 
author: oshacker
title: MySQLé«˜çº§ç³»ç»Ÿå­¦ä¹ ç¬”è®°
category: database
tags: [cs,datebase]
excerpt: æµæ°´è´¦ï¼Œä¸å–œå‹¿å–·ğŸ˜„

---

## å‰è¨€

### å¿…å¤‡åŸºç¡€çŸ¥è¯†

MySQLè½¯ä»¶ä¸‹è½½å’Œå®‰è£…ï¼ˆæˆ‘ä½¿ç”¨5.7.30ï¼‰

ç†Ÿæ‚‰MySQLå·¥å…·å’ŒåŸºæœ¬SQLæ“ä½œ

+ windowsï¼šMySQL WorkBenchã€Navicatã€SQLyog
+ Linuxï¼šMySQL WorkBenchã€Navicat
+ Macï¼šNavicatã€Sequel Pro

ç†Ÿæ‚‰ä¸»é”®ã€å¤–é”®ã€éç©ºã€å”¯ä¸€ç­‰çº¦æŸ

ç†Ÿæ‚‰ç´¢å¼•ã€äº‹åŠ¡æ¦‚å¿µå’ŒåŸºæœ¬ä½¿ç”¨

### ä¸»è¦å­¦ä¹ å†…å®¹

MySQLæ¶æ„åŸç†å’Œå­˜å‚¨æœºåˆ¶

+ MySQLä½“ç³»ç»“æ„ï¼ˆå†…å­˜ç»“æ„ã€ç£ç›˜ç»“æ„ï¼‰ã€SQLè¿è¡Œæœºåˆ¶ã€å­˜å‚¨å¼•æ“ã€Undo/Redo Logç­‰

MySQLç´¢å¼•å­˜å‚¨æœºåˆ¶å’Œå·¥ä½œåŸç†

+ ç´¢å¼•å­˜å‚¨ç»“æ„ã€ç´¢å¼•æŸ¥è¯¢åŸç†ã€ç´¢å¼•åˆ†æå’Œä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–ç­‰

MySQLäº‹åŠ¡å’Œé”å·¥ä½œåŸç†

+ äº‹åŠ¡éš”ç¦»çº§åˆ«ã€äº‹åŠ¡å¹¶å‘å¤„ç†ã€é”æœºåˆ¶å’Œå®æˆ˜ç­‰

MySQLé›†ç¾¤æ¶æ„åŠç›¸å…³åŸç†

+ é›†ç¾¤æ¶æ„è®¾è®¡ç†å¿µã€ä¸»åŠ¨æ¶æ„ã€åŒä¸»æ¶æ„ã€åˆ†åº“åˆ†è¡¨ç­‰

äº’è”ç½‘æµ·é‡æ•°æ®å¤„ç†å®æˆ˜

+ ShardingSphereã€MyCatä¸­é—´ä»¶å®æˆ˜æ“ä½œã€åˆ†åº“åˆ†è¡¨å®æˆ˜

MySQLç¬¬ä¸‰æ–¹å·¥å…·å®æˆ˜

+ åŒæ­¥å·¥å…·ã€è¿ç»´å·¥å…·ã€ç›‘æ§å·¥å…·ç­‰

### MySQLèµ·æºå’Œåˆ†æ”¯

MySQL æ˜¯æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“è½¯ä»¶ä¹‹ä¸€ï¼Œç”±äºå…¶ä½“ç§¯å°ã€é€Ÿåº¦å¿«ã€å¼€æºå…è´¹ã€ç®€å•æ˜“ç”¨ã€ç»´æŠ¤æˆæœ¬ä½ç­‰ï¼Œåœ¨é›†ç¾¤æ¶æ„ä¸­æ˜“äºæ‰©å±•ã€é«˜å¯ç”¨ï¼Œå› æ­¤æ·±å—å¼€å‘è€…å’Œä¼ä¸šçš„æ¬¢è¿ã€‚

Oracleå’ŒMySQLæ˜¯ä¸–ç•Œå¸‚åœºå æ¯”æœ€é«˜çš„ä¸¤ç§æ•°æ®åº“ã€‚ 

+ Oracle:å„æ–­ï¼Œæœ‰é’±çš„å¤§ä¼ä¸šé‡‡ç”¨ï¼Œäº’è”ç½‘ä¼ä¸šä¹‹å¤–ä½¿ç”¨ç¬¬ä¸€ã€‚
+  MySQL:äº’è”ç½‘é«˜é€Ÿå‘å±•ï¼Œäº’è”ç½‘ä¼ä¸šä½¿ç”¨ç¬¬ä¸€ã€‚

> IOE: IBMçš„æœåŠ¡å™¨ï¼ŒOracleæ•°æ®åº“ï¼ŒEMCå­˜å‚¨è®¾å¤‡ã€‚éƒ½æ˜¯æœ‰é’±çš„å…¬å¸äº§å“é‡‡è´­ï¼Œä¾‹å¦‚é“¶è¡Œã€ç”µä¿¡ã€çŸ³æ²¹ã€è¯åˆ¸ç­‰å¤§ä¼ä¸šã€‚

MySQLå‘å±•å†ç¨‹å¦‚ä¸‹ï¼š

![image-20220104101544950](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220104101544950.png)

MySQLä¸»æµåˆ†æ”¯å¦‚ä¸‹å›¾ï¼š

![image-20220104102214521](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220104102214521.png)

MySQLä»æœ€åˆçš„1.0ã€3.1åˆ°åæ¥çš„8.0ï¼Œå‘ç”Ÿäº†å„ç§å„æ ·çš„å˜åŒ–ã€‚è¢«Oracleæ”¶è´­åï¼ŒMySQLçš„ç‰ˆæœ¬æ¼”åŒ–å‡ºäº†å¤šä¸ªåˆ†æ”¯ï¼Œé™¤äº†éœ€è¦ä»˜è´¹çš„MySQLä¼ä¸šç‰ˆæœ¬ï¼Œè¿˜æœ‰å¾ˆå¤šMySQLç¤¾åŒºç‰ˆæœ¬ã€‚

+ å…¶ä¸­ä¸€æ¡éå¸¸æµè¡Œçš„å¼€æºåˆ†æ”¯ç‰ˆæœ¬å«Percona Serverï¼Œå®ƒæ˜¯MySQLçš„æŠ€æœ¯æ”¯æŒå…¬å¸Perconaæ¨å‡ºçš„ï¼Œä¹Ÿæ˜¯åœ¨å®é™…å·¥ä½œä¸­ç»å¸¸ç¢°åˆ°çš„ã€‚Percona Serveråœ¨MySQLå®˜æ–¹ç‰ˆæœ¬çš„åŸºç¡€ä¸Šåšäº†ä¸€äº›è¡¥ä¸å’Œä¼˜åŒ–ï¼ŒåŒæ—¶æ¨å‡ºäº†ä¸€äº›å·¥å…·ã€‚
+ å¦å¤–ä¸€ä¸ªéå¸¸ä¸é”™çš„ç‰ˆæœ¬å«MariaDBï¼Œå®ƒæ˜¯MySQLçš„å…¬å¸è¢«Oracleæ”¶è´­åï¼ŒMySQLçš„åˆ›å§‹äººMontyå…ˆç”ŸæŒ‰åŸæ¥çš„æ€è·¯é‡æ–°å†™çš„ä¸€å¥—æ–°æ•°æ®åº“ï¼ŒåŒæ—¶ä¹ŸæŠŠ InnoDB å¼•æ“ä½œä¸ºä¸»è¦å­˜å‚¨å¼•æ“ï¼Œä¹Ÿç®— MySQL çš„ åˆ†æ”¯ã€‚

### MySQLåº”ç”¨æ¶æ„æ¼”å˜

ä¸šåŠ¡ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹ï¼šéšç€ç”¨æˆ·å¢å¤šï¼Œç½‘ç«™çš„è®¿é—®é‡ä¸æ–­å¢é•¿ï¼Œæ•´ä¸ªç³»ç»Ÿçš„æ¶æ„ä¹Ÿä¼šä»æœ€åˆçš„å•ä½“æ¶æ„æ¼”å˜ä¸ºå‚ç›´æ¶æ„ï¼Œå†åˆ°åæ¥çš„åˆ†å¸ƒå¼SOAæ¶æ„å’Œåˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œä¸”åœ¨è¿™äº›æ¶æ„ä¸­å¯ä»¥ä½¿ç”¨é›†ç¾¤æ¥æå‡ç³»ç»Ÿå¯¹è¯·æ±‚å¤„ç†çš„çš„é«˜å¹¶å‘å’Œé«˜å¯ç”¨ï¼Œæ¯”å¦‚åº”ç”¨æœåŠ¡å™¨é›†ç¾¤ã€å¾®æœåŠ¡é›†ç¾¤ç­‰ã€‚

ä¸ºäº†æå‡ç³»ç»Ÿå¯¹é«˜å¹¶å‘è¯·æ±‚çš„å¤„ç†èƒ½åŠ›ï¼Œé™¤äº†å‰é¢æåˆ°çš„é›†ç¾¤å¤–ï¼Œæ•°æ®åº“çš„å­˜å‚¨å’Œè®¿é—®ä¹Ÿæ˜¯æ€§èƒ½ä¼˜åŒ–éå¸¸å…³é”®çš„ç¯èŠ‚ï¼Œå› ä¸ºç”¨æˆ·çš„è¯·æ±‚å‘é€è¿‡æ¥åï¼Œéœ€è¦åº”ç”¨æœåŠ¡å™¨ã€ä¸šåŠ¡æœåŠ¡å™¨å’Œå­˜å‚¨æœåŠ¡å™¨å…±åŒé…åˆæ¥å®Œæˆè¯·æ±‚çš„å“åº”ã€‚å› æ­¤ï¼Œè¿™é‡Œä»‹ç»ç½‘ç«™åœ¨ä¸åŒçš„å¹¶å‘è®¿é—®é‡çº§å’Œæ•°æ®é‡çº§ä¸‹ï¼ŒMySQLåº”ç”¨æ¶æ„çš„æ¼”å˜è¿‡ç¨‹ã€‚

**æ¶æ„v1.0-å•æœºå•åº“**

ä¸€å°æœåŠ¡å™¨å®‰è£…ä¸€ä¸ªMySQL instanceï¼ˆå¿½ç•¥æ‰äº†æ•°æ®å¤‡ä»½çš„å®ä¾‹ï¼‰ï¼Œåœ¨è¿™ä¸ªMySQLä¸­å­˜å‚¨äº†ç³»ç»Ÿçš„æ‰€æœ‰æ•°æ®ï¼Œç³»ç»Ÿé€šè¿‡æ•°æ®è®¿é—®å±‚å®Œæˆå¯¹è¿™å°æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“çš„è¯»å†™æ“ä½œã€‚é€‚ç”¨äºç®€å•çš„å°å‹ç½‘ç«™æˆ–åº”ç”¨ã€‚

![image-20220104184938633](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220104184938633.png)

æ¶æ„v1.0å­˜åœ¨çš„é—®é¢˜ï¼š

+ æ•°æ®åº“å­˜å‚¨äº†æ‰€æœ‰çš„æ•°æ®ï¼Œæ•°æ®é‡å¤ªå¤§ï¼Œè¶…å‡ºä¸€å°æœåŠ¡å™¨çš„æ‰¿å—èƒ½åŠ›
+ è¯»å†™æ“ä½œé‡å¤ªå¤§ï¼ˆç”¨æˆ·è®¿é—®é‡å¾ˆå¤§ï¼‰ï¼Œè¶…å‡ºä¸€å°æœåŠ¡å™¨æ‰¿å—èƒ½åŠ›
+ ä¸€å°æœåŠ¡å™¨æŒ‚äº†ï¼Œåº”ç”¨ä¹Ÿä¼šæŒ‚æ‰ï¼ˆå¯ç”¨æ€§å·®ï¼‰

**æ¶æ„v2.0-ä¸»ä»æ¶æ„**

3å°æœºå™¨å„å®‰è£…ä¸€ä¸ªMySQL instanceï¼Œä¸€ä¸ªä¸»åº“2ä¸ªä»åº“ï¼Œé€šè¿‡ä¸»ä»ç»“æ„ï¼ˆåŒä¸»ç»“æ„ä¹Ÿå±äºç‰¹æ®Šçš„ä¸»ä»ï¼‰è§£å†³äº†æ¶æ„v1.0ä¸‹çš„é«˜å¯ç”¨å’Œè¯»æ‰©å±•é—®é¢˜ã€‚

+ ä¸»åº“å®•æœºæ—¶ï¼Œå¯ä»¥æŠŠä»åº“ä¼šåˆ‡æ¢æˆä¸»åº“æ¥ä¿è¯é«˜å¯ç”¨ï¼›

+ é€šè¿‡ç»™InstanceæŒ‚è½½ä»åº“ï¼ˆå¯ä»¥æ›´å¤šï¼‰è§£å†³è¯»å–çš„å‹åŠ›ï¼Œä¸»åº“æŠ—å†™å‹åŠ›ï¼Œä»åº“åˆ†æ‹…è¯»å‹åŠ›ï¼Œå³è¯»å†™åˆ†ç¦»ã€‚å¯¹äºå†™å°‘è¯»å¤šçš„åº”ç”¨ï¼Œv2.0ä¸»ä»æ¶æ„å®Œå…¨èƒ½å¤Ÿèƒœä»»ã€‚

![image-20220104185241609](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220104185241609.png)

æ¶æ„v2.0å­˜åœ¨çš„é—®é¢˜ï¼š

+ æ•°æ®é‡å¤ªå¤§ï¼ˆè™½ç„¶é‡‡ç”¨äº†ä¸»ä»ç»“æ„ï¼Œä½†æ˜¯æ¯ä¸ªæ•°æ®åº“å­˜å‚¨çš„ä»ç„¶æ˜¯å®Œæ•´æ•°æ®ï¼‰ï¼Œè¶…å‡ºä¸€å°æœåŠ¡å™¨çš„æ‰¿å—èƒ½åŠ›
+ å†™æ“ä½œé‡å¤ªå¤§ï¼Œè¶…å‡ºä¸€å°MæœåŠ¡å™¨çš„æ‰¿å—èƒ½åŠ›

**æ¶æ„v3.0-åˆ†åº“åˆ†è¡¨**

æ¶æ„v1.0å’Œv2.0é‡åˆ°å†™å…¥ç“¶é¢ˆå’Œå­˜å‚¨ç“¶é¢ˆæ—¶ï¼Œå¯ä»¥é€šè¿‡æ°´å¹³æ‹†åˆ†æ¥è§£å†³ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°†UserInfoæ‹†åˆ†ä¸º3ä¸ªShardingï¼Œæ¯ä¸ªShardingæŒæœ‰æ€»é‡çš„1/3æ•°æ®ï¼Œ3ä¸ªShardingæ•°æ®çš„æ€»å’Œç­‰äºä¸€ä»½å®Œæ•´æ•°æ®ã€‚

> æ°´å¹³æ‹†åˆ†å’Œå‚ç›´æ‹†åˆ†çš„åŒºåˆ«ï¼šå‚ç›´æ‹†åˆ†åï¼Œæ¯ä¸€ä¸ªå®ä¾‹éƒ½æ‹¥æœ‰å…¨éƒ¨æ•°æ®ï¼›æ°´å¹³æ‹†åˆ†åï¼Œä»»ä½•å®ä¾‹éƒ½åªæœ‰å…¨é‡æ•°æ®çš„1/nã€‚

![image-20220104185315742](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220104185315742.png)

è¿™ç§æ¶æ„çš„å¤æ‚æ€§æ¯”è¾ƒé«˜ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š

+ æ•°æ®å¦‚ä½•è·¯ç”±ï¼Œå³ä¸€ä¸ªè¯·æ±‚åº”è¯¥åˆ†å‘ç»™å“ªä¸ªæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“ï¼›
+ ä¸€ä¸ªè¡¨çš„æ•°æ®å¦‚ä½•æ‹†åˆ†ï¼Œä¸€èˆ¬å¯ä»¥é‡‡ç”¨èŒƒå›´æ‹†åˆ†ï¼Œlistæ‹†åˆ†ï¼Œhashæ‹†åˆ†ç­‰ï¼›
+ å¦‚ä½•ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§

**æ¶æ„v4.0-äº‘æ•°æ®åº“**

äº‘æ•°æ®åº“ï¼ˆäº‘è®¡ç®—ï¼‰æ˜¯å…¬å¸èŠ‚çº¦æˆæœ¬çš„ä¸€ä¸ªçªç ´å£ï¼Œå¯¹äºæ•°æ®å­˜å‚¨çš„MySQLæ¥è¯´ï¼Œå¦‚ä½•è®©å…¶æˆä¸ºä¸€ä¸ªSassï¼ˆSoftware as a serviceï¼‰æ˜¯å…³é”®ç‚¹ã€‚MySQLä½œä¸ºä¸€ä¸ªSassæœåŠ¡ï¼ŒæœåŠ¡æä¾›å•†è´Ÿè´£è§£å†³å¯é…ç½®æ€§ã€å¯æ‰©å±•æ€§ã€å¤šç”¨æˆ·å­˜å‚¨ç»“æ„è®¾è®¡ç­‰ç–‘éš¾é—®é¢˜ã€‚

![image-20220104185442848](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220104185442848.png)

## MySQL0æ¶æ„åŸç†

### MySQLä½“ç³»ç»“æ„

![image-20220104223151509](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220104223151509.png)

MySQL Serverè‡ªé¡¶å‘ä¸‹å¤§è‡´å¯ä»¥åˆ†ä¸ºå››å±‚ï¼š

+ ç½‘ç»œè¿æ¥å±‚

  + å®¢æˆ·ç«¯è¿æ¥å™¨ï¼ˆClient Connectorsï¼‰ï¼šæä¾›ä¸MySQLæœåŠ¡å™¨å»ºç«‹è¿æ¥çš„æ”¯æŒã€‚ç›®å‰ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰ä¸»æµçš„æœåŠ¡ç«¯ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚Javaã€Cã€Pythonç­‰ï¼Œå®ƒä»¬é€šè¿‡å„è‡ªAPIä¸MySQLæœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚

+ æœåŠ¡å±‚ï¼šMySQL Serverçš„æ ¸å¿ƒï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å…­éƒ¨åˆ†ã€‚

  + è¿æ¥æ± ï¼ˆConnection Poolï¼‰ï¼šè´Ÿè´£å­˜å‚¨å’Œç®¡ç†å®¢æˆ·ç«¯ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ç®¡ç†ä¸€ä¸ªè¿æ¥ï¼ˆè¿™é‡Œè¿˜æåˆ°äº†çº¿ç¨‹æ± ï¼Œåç»­å†æ·±å…¥ï¼‰ã€‚

  + ç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·ï¼ˆManagement Services & Utilities)ï¼šæ¯”å¦‚å¤‡ä»½æ¢å¤ã€å®‰å…¨ç®¡ç†ã€é›†ç¾¤ç®¡ç†ç­‰

  + SQLæ¥å£ï¼ˆSQL Interfaceï¼‰ï¼šç”¨äºæ¥å—å®¢æˆ·ç«¯å‘é€çš„å„ç§SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚DMLã€DDLã€å­˜å‚¨è¿‡ç¨‹ã€è§†å›¾ã€è§¦å‘å™¨ç­‰ã€‚

  + è§£æå™¨ï¼ˆParserï¼‰ï¼šè´Ÿè´£å°†è¯·æ±‚çš„SQLç”Ÿæˆä¸€ä¸ªâ€œè§£ææ ‘â€ï¼ˆè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼‰ï¼Œç„¶åæ ¹æ®ä¸€äº›MySQLè§„åˆ™è¿›ä¸€æ­¥æ£€æŸ¥è§£ææ ‘æ˜¯å¦åˆæ³•ã€‚

  + æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ˆOptimizerï¼‰ï¼šå½“è§£ææ ‘é€šè¿‡è§£æå™¨è¯­æ³•æ£€æŸ¥åï¼Œå°†äº¤ç»™ä¼˜åŒ–å™¨å°†å…¶è½¬åŒ–æˆæ‰§è¡Œè®¡åˆ’ï¼Œç„¶åä¸å­˜å‚¨å¼•æ“äº¤äº’ã€‚

    > ç±»ä¼¼äºå¯»æ‰¾æœ€ä¼˜è·¯å¾„ï¼Œé‚£ä¹ˆç©¶ç«Ÿæ˜¯å¦‚ä½•ä¼˜åŒ–ï¼Ÿ
    >
    > å¯¹äºselect uid,name from user where gender=1;ï¼Œå®ƒä¼šæŒ‰ç…§é€‰å–->æŠ•å½±->è”æ¥çš„ç­–ç•¥è¿›è¡Œä¼˜åŒ–ã€‚
    >
    > + å…ˆæ ¹æ®whereè¯­å¥è¿›è¡Œé€‰å–ï¼Œè€Œä¸æ˜¯æŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®å†è¿‡æ»¤ï¼›
    > + æ ¹æ®uidå’Œnameè¿›è¡Œå±æ€§æŠ•å½±ï¼Œè€Œä¸æ˜¯å–å‡ºæ‰€æœ‰å­—æ®µï¼›
    > + å°†ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶è”æ¥èµ·æ¥æœ€ç»ˆç”ŸæˆæŸ¥è¯¢ç»“æœã€‚

  + ç¼“å­˜ï¼ˆCache&Bufferï¼‰ï¼šç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ã€è®°å½•ç¼“å­˜ã€æƒé™ç¼“å­˜ã€å¼•æ“ç¼“å­˜ç­‰ã€‚å¦‚æœæŸ¥è¯¢ç¼“å­˜æœ‰å‘½ä¸­çš„æŸ¥è¯¢ç»“æœï¼ŒæŸ¥è¯¢è¯­å¥å°±å¯ä»¥ç›´æ¥å»æŸ¥è¯¢ç¼“å­˜ä¸­å–æ•°æ®ã€‚

+ å­˜å‚¨å¼•æ“å±‚

  + å­˜å‚¨å¼•æ“è´Ÿè´£MySQLä¸­æ•°æ®çš„å­˜å‚¨ä¸æå–ï¼Œä¸åº•å±‚ç³»ç»Ÿæ–‡ä»¶è¿›è¡Œäº¤äº’ã€‚
  + MySQLçš„å­˜å‚¨å¼•æ“æ˜¯æ’ä»¶å¼çš„ï¼ŒæœåŠ¡å™¨ä¸­çš„ã€æŸ¥è¯¢æ‰§è¡Œå¼•æ“ã€‘é€šè¿‡æ¥å£ä¸ã€å­˜å‚¨å¼•æ“ã€‘è¿›è¡Œé€šä¿¡ï¼Œæ¥å£å±è”½äº†ä¸åŒå¼•æ“ä¹‹é—´çš„å·®å¼‚ã€‚å¸¸è§çš„å­˜å‚¨å¼•æ“æœ‰InnoDBå’ŒMyISAMã€‚
  + å­˜å‚¨å¼•æ“æ˜¯é’ˆå¯¹è¡¨çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åº“çš„ï¼Œå³ä¸€ä¸ªåº“ä¸­çš„ä¸¤ä¸ªè¡¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„å­˜å‚¨å¼•æ“ã€‚

+ ç³»ç»Ÿæ–‡ä»¶å±‚ï¼šè´Ÿè´£å°†æ•°æ®åº“çš„æ•°æ®å’Œæ—¥å¿—å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ï¼Œæ˜¯æ–‡ä»¶çš„ç‰©ç†å­˜å‚¨å±‚ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ éƒ¨åˆ†ã€‚

  + æ—¥å¿—æ–‡ä»¶

    + é”™è¯¯æ—¥å¿—ï¼ˆError logï¼‰ï¼š é»˜è®¤å¼€å¯ï¼Œshow variables like '%log_err%';
    + é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼ˆGeneral query logï¼‰ï¼šè®°å½•ä¸€èˆ¬æŸ¥è¯¢è¯­å¥ï¼Œshow variables like '%general%';
    + äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinary logï¼‰ï¼šè®°å½•äº†å¯¹MySQLæ•°æ®åº“æ‰§è¡Œçš„æ›´æ”¹æ“ä½œï¼Œå¹¶ä¸”è®°å½•äº†è¯­å¥çš„å‘ç”Ÿæ—¶é—´ã€æ‰§è¡Œæ—¶é•¿ï¼Œä½†å®ƒä¸è®°å½•selectã€showç­‰ä¸ä¿®æ”¹æ•°æ®åº“çš„SQLã€‚ä¸»è¦ç”¨äºæ•°æ®åº“æ¢å¤å’Œä¸»ä»å¤åˆ¶ã€‚
      + Show variables like '%log_bin%'; //æ˜¯å¦å¼€å¯
      + Show variables like '%binlog%'; //å‚æ•°æŸ¥çœ‹
      + Show binary logs; //æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
    + æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆSlow query logï¼‰ï¼šè®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…æ—¶çš„æŸ¥è¯¢SQLï¼Œé»˜è®¤ä¸º10sã€‚
      + Show variables like '%slow_query%'; //æ˜¯å¦å¼€å¯
      + Show variables like '%long_query_time%'; //æ—¶é•¿
      + set long_query_time = 5; //ä¿®æ”¹æ—¶é•¿ï¼Œå…¶ä»–ç±»ä¼¼

  + é…ç½®æ–‡ä»¶

    + ç”¨äºå­˜æ”¾MySQLæ‰€æœ‰çš„é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚my.cnfã€my.iniç­‰ã€‚

  + æ•°æ®æ–‡ä»¶ï¼š

    + show variables like '%datadir%';  //æŸ¥çœ‹æ•°æ®æ–‡ä»¶è·¯å¾„

    + db.optæ–‡ä»¶ï¼šè®°å½•è¿™ä¸ªåº“é»˜è®¤ä½¿ç”¨çš„å­—ç¬¦é›†å’Œæ ¡éªŒè§„åˆ™ï¼›

    + frmæ–‡ä»¶ï¼šå­˜å‚¨å’Œè¡¨ç›¸å…³çš„å…ƒæ•°æ®ï¼ˆmetaï¼‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„çš„å®šä¹‰ä¿¡æ¯ç­‰ï¼Œæ¯å¼ è¡¨éƒ½ä¼šæœ‰ä¸€ä¸ª.frmæ–‡ä»¶ã€‚

    + MYDæ–‡ä»¶ã€MYIæ–‡ä»¶ï¼šMyISAMå­˜å‚¨å¼•æ“ä¸“ç”¨ï¼Œå‰è€…ç”¨äºå­˜æ”¾MyISAMè¡¨çš„æ•°æ®ï¼Œæ¯å¼ è¡¨éƒ½ä¼šæœ‰ä¸€ä¸ª.MYDæ–‡ä»¶ï¼›åè€…å­˜æ”¾MyISAMè¡¨çš„ç´¢å¼•ç›¸å…³ä¿¡æ¯ï¼Œæ¯ä¸€å¼ MyISAMè¡¨å¯¹åº”ä¸€ä¸ª.MYIæ–‡ä»¶ã€‚

    + idbæ–‡ä»¶å’ŒIBDATAæ–‡ä»¶ï¼šå­˜æ”¾InnoDBçš„æ•°æ®æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç´¢å¼•ï¼‰ã€‚

      > InnoDBå­˜å‚¨å¼•æ“æœ‰ä¸¤ç§è¡¨ç©ºé—´æ–¹å¼ï¼šç‹¬äº«è¡¨ç©ºé—´å’Œå…±äº«è¡¨ç©ºé—´ï¼ˆç³»ç»Ÿè¡¨ç©ºé—´ï¼‰ã€‚
      >
      > ç‹¬äº«è¡¨ç©ºé—´ä½¿ç”¨.ibdæ–‡ä»¶æ¥å­˜æ”¾æ•°æ®ï¼Œä¸”æ¯ä¸€å¼ InnoDBè¡¨å¯¹åº”ä¸€ä¸ª.ibdæ–‡ä»¶ï¼›å…±äº«è¡¨ç©ºé—´ä½¿ç”¨.ibdataæ–‡ä»¶ï¼Œæ‰€æœ‰è¡¨å…±åŒä½¿ç”¨ä¸€ä¸ª/å¤šä¸ªï¼ˆè‡ªè¡Œé…ç½®ï¼‰.ibdataæ–‡ä»¶ã€‚

    + ibdata1æ–‡ä»¶ï¼šç³»ç»Ÿè¡¨ç©ºé—´æ•°æ®æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨è¡¨å…ƒæ•°æ®ã€Undoæ—¥å¿—ç­‰ï¼›

    + ib_logfile0ã€ib_logfile1æ–‡ä»¶ï¼šRedo logæ—¥å¿—æ–‡ä»¶ã€‚

  + pidæ–‡ä»¶

    + pidæ–‡ä»¶æ˜¯mysqldåº”ç”¨ç¨‹åºåœ¨Unix/Linuxç¯å¢ƒä¸‹çš„ä¸€ä¸ªè¿›ç¨‹æ–‡ä»¶ï¼Œå’Œå…¶ä»–Unix/LinuxæœåŠ¡ç«¯ç¨‹åºä¸€æ ·ï¼Œå®ƒå­˜æ”¾ç€è‡ªå·±çš„è¿›ç¨‹idã€‚

  + socketæ–‡ä»¶

    + socketæ–‡ä»¶ä¹Ÿæ˜¯åœ¨Unix/Linuxç¯å¢ƒä¸‹æ‰æœ‰çš„ï¼Œç”¨æˆ·åœ¨Unix/Linuxç¯å¢ƒä¸‹å®¢æˆ·ç«¯å¯ä»¥ä¸é€šè¿‡TCP/IPè€Œç›´æ¥ä½¿ç”¨Unix Socketæ¥è¿æ¥MySQLã€‚

### MySQLè¿è¡Œæœºåˆ¶

![image-20220105171113016](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220105171113016.png)

å»ºç«‹è¿æ¥ï¼ˆConnectors & Connection Poolï¼‰

+ å®¢æˆ·ç«¯é€šè¿‡C/Sé€šä¿¡åè®®ä¸MySQLå»ºç«‹è¿æ¥ï¼ŒMySQLå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„é€šä¿¡æ–¹å¼æ˜¯â€œåŠåŒå·¥â€ã€‚å¯¹äºæ¯ä¸€ä¸ªMySQLè¿æ¥ï¼Œæ—¶åˆ»éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹çŠ¶æ€æ¥æ ‡è¯†è¿™ä¸ªè¿æ¥æ­£åœ¨åšä»€ä¹ˆã€‚

  > é€šä¿¡æœºåˆ¶ï¼š
  >
  > + å…¨åŒå·¥ï¼šå®¢æˆ·ç«¯ï¼ˆæˆ–æœåŠ¡å™¨ï¼‰èƒ½åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œä¾‹å¦‚å¹³æ—¶æ‰“ç”µè¯ï¼›
  > + åŠåŒå·¥ï¼šæŸä¸€æ—¶åˆ»ï¼Œè¦ä¹ˆå‘é€æ•°æ®ï¼Œè¦ä¹ˆæ¥å—æ•°æ®ï¼Œä¸èƒ½åŒæ—¶ï¼Œæ¯”ä¾‹æ—©æœŸçš„å¯¹è®²æœºã€‚
  > + å•å·¥ï¼šåªèƒ½å‘é€æ•°æ®æˆ–åªèƒ½æ¥æ”¶æ•°æ®ï¼Œæ¯”å¦‚å•è¡Œé“ã€‚
  >
  > çº¿ç¨‹çŠ¶æ€ï¼š
  >
  > + Show processlist; //æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ä¿¡æ¯ï¼ˆæŸ¥çœ‹è°è¿æ¥äº†MySQLæœåŠ¡ç«¯ï¼Œè¿æ¥çŠ¶æ€ä»€ä¹ˆæ ·ï¼‰ï¼Œå…¶ä¸­rootç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹ï¼Œå…¶ä»–ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„
  > + å„ä¸ªå‚æ•°å…·ä½“ä»‹ç»ï¼š
  >   + idï¼šçº¿ç¨‹IDï¼Œå¯ä»¥ä½¿ç”¨kill xxå°†å…¶æ€æ‰
  >   + userï¼šå¯åŠ¨è¿™ä¸ªçº¿ç¨‹çš„ç”¨æˆ·
  >   + Hostï¼šå‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯IPå’Œç«¯å£
  >   + dbï¼šå½“å‰å‘½ä»¤åœ¨å“ªä¸ªåº“æ‰§è¡Œ
  >   + Commandï¼šè¯¥çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ“ä½œå‘½ä»¤
  >     + Create DBï¼šæ­£åœ¨åˆ›å»ºåº“
  >     + Drop DBï¼šæ­£åœ¨åˆ é™¤åº“
  >     + Executeï¼šæ­£åœ¨æ‰§è¡Œä¸€ä¸ªPreparedStatement
  >     + Close Stmtï¼šæ­£åœ¨å…³é—­ä¸€ä¸ªPreparedStatement
  >     + Queryï¼šæ­£åœ¨æ‰§è¡Œä¸€ä¸ªè¯­å¥
  >     + Sleepï¼šæ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€è¯­å¥
  >     + quitï¼šè¯¥çº¿ç¨‹æ­£åœ¨é€€å‡º
  >     + Shutdownï¼šæ­£åœ¨å…³é—­æœåŠ¡å™¨
  >   + Timeï¼šè¯¥çº¿ç¨‹å¤„äºå½“å‰çŠ¶æ€çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’
  >   + Stateï¼šçº¿ç¨‹çŠ¶æ€
  >     + Updatingï¼šæ­£åœ¨æœç´¢åŒ¹é…è®°å½•ï¼Œè¿›è¡Œä¿®æ”¹
  >     + Sleepingï¼šæ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ–°è¯·æ±‚
  >     + Startingï¼šæ­£åœ¨è¿›è¡Œè¯·æ±‚å¤„ç†
  >     + Checking tableï¼šæ­£åœ¨æ£€æŸ¥æ•°æ®è¡¨
  >     + Closing tableï¼šæ­£åœ¨å°†è¡¨ä¸­æ•°æ®åˆ·åˆ°ç£ç›˜ä¸­
  >     + Lockedï¼šè¢«å…¶ä»–æŸ¥è¯¢é”ä½äº†è®°å½•
  >     + Sending Dataï¼šæ­£åœ¨å¤„ç†selectæŸ¥è¯¢ï¼ŒåŒæ—¶å°†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯
  >   + Infoï¼šä¸€èˆ¬è®°å½•çº¿ç¨‹æ‰§è¡Œçš„è¯­å¥ï¼Œé»˜è®¤æ˜¾ç¤ºå‰100ä¸ªå­—ç¬¦ï¼Œæƒ³æŸ¥çœ‹å®Œæ•´çš„ä½¿ç”¨show full processlistã€‚

+ æŸ¥è¯¢ç¼“å­˜ï¼ˆCache&Bufferï¼‰ï¼šMySQLå¯¹æŸ¥è¯¢çš„ä¼˜åŒ–ï¼Œå¦‚æœå¼€å¯äº†æŸ¥è¯¢ç¼“å­˜ä¸”æŸ¥è¯¢åˆ°å®Œå…¨ç›¸åŒçš„SQLï¼Œåˆ™å°†æŸ¥è¯¢ç»“æœç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼›å¦‚æœæ²¡æœ‰å¼€å¯æŸ¥è¯¢ç¼“å­˜æˆ–æ²¡æœ‰æŸ¥è¯¢åˆ°å®Œå…¨ç›¸åŒçš„SQLï¼Œå°±ä¼šç”±è§£æå™¨è¿›è¡Œè¯­æ³•è¯­ä¹‰åˆ†æï¼Œå¹¶ç”Ÿæˆâ€œè§£ææ ‘â€ã€‚

  + ç¼“å­˜selectæŸ¥è¯¢çš„ç»“æœå’ŒSQLè¯­å¥

  + æ‰§è¡ŒselectæŸ¥è¯¢æ—¶ï¼Œå…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œè¦æ±‚å®Œå…¨ç›¸åŒï¼ˆåŒ…æ‹¬å‚æ•°ï¼‰ï¼Œè¿™æ ·æ‰ä¼šå‘½ä¸­ç¼“å­˜æ•°æ®ã€‚

  + å³ä½¿å¼€å¯æŸ¥è¯¢ç¼“å­˜ï¼Œä»¥ä¸‹SQLä¹Ÿä¸èƒ½ç¼“å­˜

    1. æŸ¥è¯¢è¯­å¥ä½¿ç”¨SQL_NO_CACHE

    2. æŸ¥è¯¢çš„ç»“æœå¤§äºquery_cache_limitè®¾ç½®
    3. æŸ¥è¯¢ä¸­æœ‰ä¸€äº›ä¸ç¡®å®šçš„å‚æ•°ï¼Œæ¯”å¦‚now()ã€‚

  + Show variables like '%query_cache%'; //æŸ¥çœ‹ç¼“å­˜æ˜¯å¦å¼€å¯ï¼Œç©ºé—´å¤§å°ç­‰

  + Show status like 'Qcache%'; //æŸ¥çœ‹æ›´è¯¦ç»†çš„ç¼“å­˜å‚æ•°ï¼Œå¯ç”¨ç¼“å­˜ç©ºé—´ï¼Œç¼“å­˜å—ç­‰

+ è§£æå™¨ï¼ˆParser)ï¼šå°†å®¢æˆ·ç«¯å‘é€çš„SQLè¿›è¡Œè¯æ³•ã€è¯­æ³•åˆ†æï¼Œç”Ÿæˆâ€œè§£ææ ‘â€ã€‚é¢„å¤„ç†å™¨æ ¹æ®ä¸€äº›MySQLè§„åˆ™è¿›ä¸€æ­¥æ£€æŸ¥â€œè§£ææ ‘â€æ˜¯å¦åˆæ³•ï¼Œæ¯”å¦‚æ£€æŸ¥æ•°æ®è¡¨å’Œæ•°æ®åˆ—æ˜¯å¦å­˜åœ¨ï¼Œè¿˜ä¼šè§£æåå­—å’Œåˆ«åï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦æœ‰æ­§ä¹‰ï¼Œæœ€åç”Ÿæˆæ–°çš„â€œè§£ææ ‘â€ã€‚

+ æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ˆOptimizerï¼‰ï¼šæ ¹æ®â€œè§£ææ ‘â€ç”Ÿæˆæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ï¼Œä½¿ç”¨çš„ä¼˜åŒ–ç­–ç•¥å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šé™æ€ä¼˜åŒ–ï¼ˆç¼–è¯‘æ—¶ä¼˜åŒ–ï¼‰ã€åŠ¨æ€ä¼˜åŒ–ï¼ˆè¿è¡Œæ—¶ä¼˜åŒ–ï¼‰ã€‚

  + ç­‰ä»·å˜æ¢ç­–ç•¥
    + 5=5 and a > 5 æ”¹æˆ a > 5ï¼›
    + a<b and a=5 æ”¹æˆ b > 5 and a = 5ï¼›
    + åŸºäºè”åˆç´¢å¼•ï¼Œè°ƒæ•´æ¡ä»¶é¡ºåºç­‰ã€‚
  + ä¼˜åŒ–countã€minã€maxç­‰å‡½æ•°
    + InnoDBå¼•æ“minå‡½æ•°åªéœ€è¦æ‰¾ç´¢å¼•æœ€å·¦è¾¹ï¼Œmaxå‡½æ•°åªéœ€è¦æ‰¾ç´¢å¼•æœ€å³è¾¹ï¼›
    + MyISAMå¼•æ“count(*)ä¸éœ€è¦è®¡ç®—ï¼Œç›´æ¥è¿”å›ã€‚
  + æå‰ç»ˆæ­¢æŸ¥è¯¢ï¼šä½¿ç”¨äº†limitæŸ¥è¯¢ï¼Œè·å–åˆ°limitæ‰€éœ€çš„æ•°æ®åï¼Œå°±ä¸å†ç»§ç»­éå†åé¢çš„æ•°æ®ã€‚
  + inçš„ä¼˜åŒ–ï¼šå…ˆè¿›è¡Œæ’åºï¼Œå†é‡‡ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾æ•°æ®ã€‚æ¯”å¦‚where id in (2,1,3) æ”¹æˆ where id in (1,2,3)ã€‚

+ æŸ¥è¯¢æ‰§è¡Œå¼•æ“ï¼šè´Ÿè´£æ‰§è¡ŒSQLè¯­å¥ï¼ŒæŸ¥è¯¢æ‰§è¡Œå¼•æ“ä¼šæ ¹æ®SQLä¸­è¡¨çš„å­˜å‚¨å¼•æ“ç±»å‹ï¼Œé€šè¿‡å¯¹åº”çš„APIæ¥å£ä¸åº•å±‚å­˜å‚¨å¼•æ“æˆ–ç‰©ç†æ–‡ä»¶è¿›è¡Œäº¤äº’ï¼Œå¾—åˆ°æŸ¥è¯¢ç»“æœå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœè¿”å›ç»“æœè¿‡å¤šï¼Œé‡‡ç”¨å¢é‡æ¨¡å¼è¿”å›ï¼ˆæœ‰ç‚¹åˆ†é¡µçš„å‘³é“ï¼‰ã€‚

  > å¦‚æœå¼€å¯æŸ¥è¯¢ç¼“å­˜ï¼Œä¼šå°†SQLå’Œç»“æœå®Œæ•´åœ°ä¿å­˜åˆ°æŸ¥è¯¢ç¼“å­˜ï¼ˆCache & Bufferï¼‰ä¸­ï¼Œå†å°†æŸ¥è¯¢ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™æ ·å¦‚æœä»¥åæœ‰ç›¸åŒçš„SQLè¯­å¥æ‰§è¡Œï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœã€‚

### MySQLå­˜å‚¨å¼•æ“

å­˜å‚¨å¼•æ“åœ¨MySQLçš„ä½“ç³»æ¶æ„ä¸­ä½äºç¬¬ä¸‰å±‚ï¼Œè´Ÿè´£MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæèµ·ï¼Œæ˜¯ä¸æ–‡ä»¶æ‰“äº¤é“çš„å­ç³»ç»Ÿï¼Œå®ƒæ˜¯æ ¹æ®MySQLæä¾›çš„ã€æ–‡ä»¶è®¿é—®å±‚æŠ½è±¡æ¥å£ã€‘å®šåˆ¶çš„ä¸€ç§æ–‡ä»¶è®¿é—®æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶å°±å«å­˜å‚¨å¼•æ“ã€‚

ä½¿ç”¨show engineså‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å¼•æ“ä¿¡æ¯ã€‚

![image-20220107164506010](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220107164506010.png)

> MySQL5.5ä¹‹å‰é»˜è®¤é‡‡ç”¨MyISAMå­˜å‚¨å¼•æ“ï¼Œä»MySQL5.5å¼€å§‹é‡‡ç”¨InnoDBå­˜å‚¨å¼•æ“ã€‚

å„å­˜å‚¨å¼•æ“ç‰¹ç‚¹ï¼š

+ InnoDBï¼šæ”¯æŒäº‹åŠ¡ï¼Œå…·æœ‰æäº¤ã€å›æ»šå’Œå´©æºƒæ¢å¤èƒ½åŠ›ï¼Œå³äº‹åŠ¡å®‰å…¨
+ MyISAMï¼šä¸æ”¯æŒäº‹åŠ¡å’Œå¤–é”®ï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œé€‚åˆæŸ¥è¯¢å¤šçš„åœºæ™¯
+ Memoryï¼šåˆ©ç”¨å†…å­˜åˆ›å»ºè¡¨ï¼Œå› ä¸ºæ•°æ®åœ¨å†…å­˜ï¼Œé»˜è®¤ä½¿ç”¨Hashç´¢å¼•ï¼Œæ‰€ä»¥è®¿é—®é€Ÿåº¦éå¸¸å¿«ã€‚ä½†ä¸€æ—¦å…³é—­ï¼Œæ•°æ®å°±ä¼šä¸¢å¤±ã€‚
+ Archiveï¼šå½’æ¡£ç±»å‹å¼•æ“ï¼Œä»…èƒ½æ”¯æŒinsertå’Œselectè¯­å¥ã€‚
+ Csvï¼šä»¥CSVæ–‡ä»¶è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œç”±äºæ–‡ä»¶é™åˆ¶ï¼Œæ‰€æœ‰åˆ—å¿…é¡»å¼ºåˆ¶æŒ‡å®šnot nullï¼Œå¦å¤–CSVå¼•æ“ä¹Ÿä¸æ”¯æŒç´¢å¼•å’Œåˆ†åŒºï¼Œé€‚åˆåšæ•°æ®äº¤æ¢çš„ä¸­é—´è¡¨ã€‚
+ BlackHoleï¼šé»‘æ´ï¼Œåªè¿›ä¸å‡ºï¼Œè¿›æ¥æ¶ˆå¤±ï¼Œæ‰€æœ‰æ’å…¥çš„æ•°æ®éƒ½ä¸ä¼šä¿å­˜ï¼Œä½†binlogä¸­ä¼šæœ‰æ“ä½œè®°å½•ã€‚æä¸æ‡‚æœ‰å•¥ç”¨ï¼
+ Federatedï¼šç”¨æ¥è®¿é—®è¿œç«¯MySQLæ•°æ®åº“ä¸­çš„è¡¨ã€‚æœ¬åœ°è¡¨ä¸ä¿å­˜æ•°æ®ï¼Œè®¿é—®è¿œç¨‹è¡¨å†…å®¹ã€‚
+ MRG_MyISAMï¼šä¸€ç»„MyISAMè¡¨çš„ç»„åˆï¼Œè¿™äº›MyISAMè¡¨å¿…é¡»ç»“æ„ç›¸åŒï¼ŒMRGè¡¨æœ¬èº«æ²¡æœ‰æ•°æ®ï¼Œä½†å¯¹MRGè¡¨çš„æ“ä½œå°±å¯ä»¥å¯¹ä¸€ç»„MyISAMè¡¨è¿›è¡Œæ“ä½œã€‚

#### InnoDBå’ŒMyISAMå¯¹æ¯”

InnoDBå’ŒMyISAMæ˜¯MySQLä¸­æœ€å¸¸ç”¨çš„ä¸¤ç§å­˜å‚¨å¼•æ“ï¼Œä¸¤è€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š

+ äº‹åŠ¡å’Œå¤–é”®

  + InnoDBæ”¯æŒäº‹åŠ¡å’Œå¤–é”®ï¼Œé€šè¿‡äº‹åŠ¡ä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼Œé€‚åˆå¤§é‡insertæˆ–updateæ“ä½œï¼›
  + MyISAMä¸æ”¯æŒäº‹åŠ¡å’Œå¤–é”®ï¼Œæä¾›é«˜é€Ÿå­˜å‚¨å’Œæ£€ç´¢ï¼Œé€‚åˆå¤§é‡çš„selectæ“ä½œã€‚

+ é”æœºåˆ¶

  + InnoDBæ”¯æŒè¡Œçº§é”ï¼Œé”å®šæŒ‡å®šè®°å½•ã€‚åŸºäºç´¢å¼•æ¥åŠ é”å®ç°ï¼ˆä¸æ˜¯å¤ªç†è§£ï¼ï¼‰ï¼›
  + MyISAMæ”¯æŒè¡¨çº§é”ï¼Œé”å®šæ•´å¼ è¡¨ã€‚

+ ç´¢å¼•ç»“æ„

  + InnoDBä½¿ç”¨èšç°‡ç´¢å¼•ï¼Œç´¢å¼•å’Œè®°å½•åœ¨ä¸€èµ·å­˜å‚¨ï¼Œæ—¢ç¼“å­˜ç´¢å¼•å€¼ï¼Œä¹Ÿç¼“å­˜è®°å½•ï¼›
  + MyISAMä½¿ç”¨éèšç°‡ç´¢å¼•ï¼Œç´¢å¼•å’Œè®°å½•åˆ†å¼€ã€‚

+ å¹¶å‘å¤„ç†èƒ½åŠ›

  + MyISAMä½¿ç”¨è¡¨é”ï¼Œä¼šå¯¼è‡´å†™æ“ä½œå¹¶å‘ç‡ä½ï¼Œè¯»ä¹‹é—´å¹¶ä¸é˜»å¡ï¼Œè¯»å†™é˜»å¡ï¼›

  + InnoDBè¯»å†™é˜»å¡èŒƒå›´ä¸éš”ç¦»çº§åˆ«æœ‰å…³ï¼Œå¯ä»¥é‡‡ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æ¥æ”¯æŒé«˜å¹¶å‘

+ å­˜å‚¨æ–‡ä»¶

  + InnoDBè¡¨å¯¹åº”ä¸¤ä¸ªæ–‡ä»¶ï¼šä¸€ä¸ª.frmè¡¨ç»“æ„æ–‡ä»¶ï¼Œä¸€ä¸ª.ibdæ•°æ®æ–‡ä»¶ã€‚InnoDBè¡¨æœ€å¤§æ”¯æŒ64TBï¼›
  + MyISAMè¡¨å¯¹åº”ä¸‰ä¸ªæ–‡ä»¶ï¼šä¸€ä¸ª.frmè¡¨ç»“æ„æ–‡ä»¶ï¼Œä¸€ä¸ª.MYDè¡¨æ•°æ®æ–‡ä»¶ï¼Œä¸€ä¸ª.MYIç´¢å¼•æ–‡ä»¶ã€‚MySQL5..0å¼€å§‹é»˜è®¤é™åˆ¶256TBã€‚



ä¸¤ç§å­˜å‚¨å¼•æ“çš„é€‚ç”¨åœºæ™¯ï¼š

+ MyISAM
  + ä¸éœ€è¦äº‹åŠ¡æ”¯æŒ
  + å¹¶å‘ç›¸å¯¹è¾ƒä½ï¼ˆè¡¨é”ï¼‰
  + æ•°æ®ä¿®æ”¹ç›¸å¯¹è¾ƒå°‘ï¼Œä»¥è¯»ä¸ºä¸»
  + æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜
+ InnoDB
  + éœ€è¦äº‹åŠ¡æ”¯æŒ
  + è¡Œçº§é”å¯¹é«˜å¹¶å‘æœ‰å¾ˆå¥½çš„é€‚åº”èƒ½åŠ›
  + æ•°æ®æ›´æ–°è¾ƒä¸ºé¢‘ç¹çš„åœºæ™¯
  + æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜
  + ç¡¬ä»¶è®¾å¤‡å†…å­˜è¾ƒå¤§ï¼Œå¯ä»¥åˆ©ç”¨InnoDBè¾ƒå¥½çš„ç¼“å­˜èƒ½åŠ›æ¥æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œå‡å°‘ç£ç›˜IOã€‚



ä¸¤ç§å¼•æ“è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ

+ æ˜¯å¦éœ€è¦äº‹åŠ¡ï¼Ÿæœ‰ï¼ŒInnoDB
+ æ˜¯å¦å­˜åœ¨å¹¶å‘ä¿®æ”¹ï¼Ÿæœ‰ï¼ŒInnoDB
+ æ˜¯å¦è¿½æ±‚å¿«é€ŸæŸ¥è¯¢ï¼Œä¸”æ•°æ®ä¿®æ”¹å°‘ï¼Ÿæ˜¯ï¼ŒMyISAMï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©InnoDB
+ åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨InnoDBã€‚



å„ä¸ªå­˜å‚¨å¼•æ“ç‰¹æ€§å¯¹æ¯”å¦‚ä¸‹å›¾ï¼š

![image-20220107165735605](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220107165735605.png)

#### InnoDBå­˜å‚¨ç»“æ„

ä»MySQL5.5å¼€å§‹é»˜è®¤ä½¿ç”¨InnoDBä½œä¸ºå­˜å‚¨å¼•æ“ï¼Œå®ƒæ“…é•¿äº‹åŠ¡å¤„ç†ï¼Œå…·æœ‰è‡ªåŠ¨å´©æºƒæ¢å¤çš„ç‰¹æ€§ã€‚ä¸‹é¢æ˜¯å®˜ç½‘æä¾›çš„InnoDBå¼•æ“æ¶æ„å›¾ï¼Œä¸»è¦åˆ†ä¸ºå†…å­˜ç»“æ„å’Œç£ç›˜ç»“æ„ä¸¤å¤§éƒ¨åˆ†ã€‚

![image-20220107184350645](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220107184350645.png)

##### InnoDBå†…å­˜ç»“æ„

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒInnoDBçš„å†…å­˜ç»“æ„ä¸»è¦åŒ…æ‹¬Buffer Poolã€Change Bufferã€Adaptive Hash Indexå’ŒLog Bufferå››å¤§ç»„ä»¶ã€‚

**Buffer Pool**

ç¼“å­˜æ± ï¼Œç®€ç§°BPï¼ŒBPä»¥pageï¼ˆé¡µï¼Œé»˜è®¤å¤§å°ä¸º16Kï¼‰ä¸ºå•ä½ï¼Œåº•å±‚é‡‡ç”¨é“¾è¡¨ç®¡ç†Pageã€‚åœ¨InnoDBè®¿é—®è¡¨è®°å½•å’Œç´¢å¼•æ—¶ä¼šåœ¨pageé¡µä¸­ç¼“å­˜ï¼Œä»¥åä½¿ç”¨å¯ä»¥å‡å°‘IOæ“ä½œï¼Œæå‡æ•ˆç‡ã€‚

1. pageç®¡ç†æœºåˆ¶

   + Pageæ ¹æ®çŠ¶æ€å¯ä»¥åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š

     + free pageï¼šç©ºé—²pageï¼Œæœªè¢«ä½¿ç”¨ï¼›
     + clean pageï¼šè¢«ä½¿ç”¨pageï¼Œæ•°æ®æ²¡è¢«ä¿®æ”¹è¿‡ï¼›
     + dirty pageï¼šè„é¡µï¼Œè¢«ä½¿ç”¨çš„pageï¼Œæ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œé¡µä¸­æ•°æ®å’Œç£ç›˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´

   + é’ˆå¯¹ä¸Šè¿°ä¸‰ç§pageç±»å‹ï¼ŒInnoDBé€šè¿‡ä¸‰ç§é“¾è¡¨ç»“æ„æ¥ç»´æŠ¤å’Œç®¡ç†ï¼š

     + free listï¼šè¡¨ç¤ºç©ºé—²ç¼“å†²åŒºï¼Œç®¡ç†free pageï¼›
     + flush listï¼šè¡¨ç¤ºéœ€è¦åˆ·æ–°åˆ°ç£ç›˜çš„ç¼“å†²åŒºï¼Œç®¡ç†dirty pageï¼Œå†…éƒ¨pageæŒ‰ä¿®æ”¹æ—¶é—´æ’åº(æœ€æ–°ä¿®æ”¹çš„pageåœ¨flush listçš„å¤´éƒ¨ï¼Œæœ€æ—©ä¿®æ”¹çš„pageåœ¨flush listçš„å°¾éƒ¨ï¼Œåˆ·ç›˜æ—¶ä»å°¾éƒ¨å¼€å§‹)ã€‚
     + lru listï¼šè¡¨ç¤ºæ­£åœ¨ä½¿ç”¨çš„ç¼“å†²åŒºï¼Œç®¡ç†clean pageå’Œdirty pageã€‚è¯¥ç¼“å†²åŒºä»¥midpointä¸ºåŸºç‚¹ï¼Œå‰é¢é“¾è¡¨ç§°ä¸ºnewåˆ—è¡¨åŒºï¼Œå­˜æ”¾ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå 63%ï¼›åé¢çš„é“¾è¡¨ç§°ä¸ºoldåˆ—è¡¨åŒºï¼Œå­˜æ”¾ä½¿ç”¨è¾ƒå°‘çš„æ•°æ®ï¼Œå 37%ã€‚

     > æ³¨æ„ï¼š
     >
     > + è„é¡µï¼ˆdirty pageï¼‰æ—¢å­˜åœ¨äºflushé“¾è¡¨ï¼Œä¹Ÿåœ¨lrué“¾è¡¨ä¸­ï¼Œä½†æ˜¯ä¸¤ç§äº’ä¸å½±å“ï¼Œlrué“¾è¡¨è´Ÿè´£ç®¡ç†pageçš„å¯ç”¨æ€§å’Œé‡Šæ”¾ï¼Œè€Œflushé“¾è¡¨è´Ÿè´£ç®¡ç†è„é¡µçš„åˆ·ç›˜æ“ä½œã€‚
     > + ä¸¤è€…ä¹Ÿæ˜¯æœ‰è”ç³»çš„ï¼šå½“è§¦å‘åˆ·ç›˜æ“ä½œæ—¶ï¼Œä¼šæŠŠå¯¹åº”pageä»lru listç§»é™¤ï¼›å½“æŸäº›pageæ·˜æ±°æ—¶ï¼Œä¹Ÿä¼šè§¦å‘å¯¹åº”pageçš„åˆ·ç›˜æ“ä½œã€‚

   + é€šè¿‡show engine innodb status \G;å¯ä»¥æŸ¥çœ‹innnodbå¼•æ“çš„çŠ¶æ€ï¼Œå¦‚ä¸‹ï¼š

     ```mysql
     ----------------------
     BUFFER POOL AND MEMORY
     ----------------------
     Total large memory allocated 140836864
     Dictionary memory allocated 131981
     Buffer pool size   8191 // Buffer Poolå…±æœ‰8191ä¸ªpage 
     Free buffers       7907 // free pageçš„æ•°é‡
     Database pages     284 // clean page + dirty pageçš„æ•°é‡ï¼Œå³lru listç®¡ç†çš„page
     Old database pages 0 // lru listä¸­oldåŒºçš„pageæ•°é‡
     Modified db pages  0 // dirty pageçš„æ•°é‡
     Pending reads      0
     Pending writes: LRU 0, flush list 0, single page 0
     Pages made young 0, not young 0
     0.00 youngs/s, 0.00 non-youngs/s
     Pages read 215, created 69, written 187
     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
     No buffer pool page gets since the last printout
     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
     LRU len: 284, unzip_LRU len: 0
     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
     ```

     ä»ä¸Šé¢å¯çŸ¥ï¼ŒBuffer pool size.= Free buffers + Database pagesï¼Œä½†ä¹Ÿå¯èƒ½å¤§äºï¼Œå› ä¸ºBPä¸­çš„æŸäº›pageå¯èƒ½ä¼šåˆ†é…ç»™Adaptive Hash Indexå’ŒChange Bufferã€‚

2. pageç©ºé—´é‡Šæ”¾ï¼ˆæ”¹è¿›å‹LRUç®—æ³•ï¼‰
   + æ™®é€šlruï¼šæœ«å°¾æ·˜æ±°æ³•ï¼Œæ–°æ•°æ®ä»é“¾è¡¨å¤´éƒ¨åŠ å…¥ï¼Œé‡Šæ”¾ç©ºé—´æ—¶ä»æœ«å°¾æ·˜æ±°ï¼›
   + æ”¹æ€§lruï¼šé“¾è¡¨åˆ†ä¸ºnewå’Œoldä¸¤ä¸ªéƒ¨åˆ†ï¼ŒåŠ å…¥å…ƒç´ æ—¶å¹¶ä¸æ˜¯ä»é“¾è¡¨å¤´éƒ¨æ’å…¥ï¼Œè€Œæ˜¯ä»ä¸­é—´midpointä½ç½®æ’å…¥ã€‚å¦‚æœæ•°æ®æ•°æ®å¾ˆå¿«è¢«è®¿é—®ï¼Œé‚£ä¹ˆpageå°±ä¼šå‘newåˆ—è¡¨å¤´éƒ¨ç§»åŠ¨ï¼›å¦‚æœæ•°æ®æ²¡æœ‰è¢«è®¿é—®ï¼Œpageä¼šé€æ­¥å‘oldå°¾éƒ¨ç§»åŠ¨ï¼Œç­‰å¾…æ·˜æ±°ã€‚é‡Šæ”¾ç©ºé—´æ—¶ä¾ç„¶ä»å°¾éƒ¨æ·˜æ±°ã€‚
   + æ¯å½“æœ‰æ–°çš„pageæ•°æ®è¯»å–åˆ°buffer poolæ—¶ï¼ŒInnoDBå¼•æ“ä¼šåˆ¤æ–­ç©ºé—²é¡µæ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœæœ‰ï¼Œå°±å°†free pageä»free liståˆ—è¡¨åˆ é™¤ï¼Œæ”¾å…¥åˆ°lrué“¾è¡¨ä¸­ï¼›å¦‚æœæ²¡æœ‰ç©ºé—²é¡µï¼Œå°±ä¼šæ ¹æ®lruç®—æ³•æ·˜æ±°æ‰lrué“¾è¡¨æœ«å°¾çš„é¡µï¼Œå°†å†…å­˜ç©ºé—´é‡Šæ”¾åˆ†é…ç»™æ–°çš„é¡µã€‚

3. Buffer Poolé…ç½®å‚æ•°

   + show variables like '%innodb_page_size%'; //æŸ¥çœ‹pageé¡µå¤§å°

     > å¯¹äºç¡®å®šçš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨select @@innodb_page_size/1.24;æ¥æŸ¥çœ‹ã€‚

   + show variables like '%innodb_old%'; //æŸ¥çœ‹lru listä¸­oldåˆ—è¡¨æ‰€å æ¯”ä¾‹

   + show variables like '%innodb_buffer%'; //æŸ¥çœ‹buffer poolå‚æ•°

     > å…·ä½“å…³ç³»æ˜¯innnodb_buffer_pool_sizeåˆ†ä¸ºå‡ ä¸ªinnnodb_buffer_pool_instancesï¼Œæ¯ä¸ªinnodb_buffer_pool_instancesåˆ†ä¸ºå‡ ä¸ªinnodb_buffer_pool_chunk_sizeï¼Œæ¯ä¸ªinnodb_buffer_pool_chunk_sizeåˆ†ä¸ºå‡ ä¸ªinnodb_page_sizeã€‚

   > å»ºè®®ï¼šå°†innnodb_buffer_pool_sizeè®¾ç½®ä¸ºæ€»å†…å­˜å¤§å°çš„60%-80%ï¼Œinnodb_buffer_pool_instanceså¯ä»¥è®¾ç½®ä¸ºå¤šä¸ªï¼Œè¿™æ ·å½“è¾ƒå¤šæ•°æ®åŠ è½½åˆ°å†…å­˜æ—¶ï¼Œä½¿ç”¨å¤šä¸ªå®ä¾‹å¯ä»¥é™ä½ç¼“å­˜ç«äº‰ã€‚

**Change Buffer**

å†™ç¼“å†²åŒºï¼Œç®€ç§°CBã€‚åœ¨è¿›è¡ŒDMLæ“ä½œæ—¶ï¼Œå¦‚æœBPæ²¡æœ‰ç›¸åº”çš„pageæ•°æ®ï¼Œå¹¶ä¸ä¼šç«‹åˆ»å°†ç£ç›˜é¡µåŠ è½½åˆ°ç¼“å†²æ± BPï¼Œè€Œæ˜¯åœ¨CBè®°å½•ç¼“å†²å˜æ›´ï¼Œç­‰å°†æ¥æ•°æ®è¢«è¯»å–æ—¶ï¼Œå†å°†æ•°æ®åˆå¹¶æ¢å¤åˆ°BPä¸­ã€‚

+ Change bufferå ç”¨Buffer Poolç©ºé—´ï¼Œé»˜è®¤ä¸º25%ï¼Œæœ€å¤§å…è®¸å 50%ï¼Œå¯ä»¥æ ¹æ®è¯»å†™ä¸šåŠ¡é‡æ¥è¿›è¡Œè°ƒæ•´ï¼Œå‚æ•°ä¸ºinnodb_change_buffer_max_size;

+ å½“æ›´æ–°ä¸€æ¡è®°å½•æ—¶ï¼Œå¦‚æœè¯¥è®°å½•åœ¨Buffer Poolä¸­å­˜åœ¨ï¼Œç›´æ¥åœ¨BPä¸­ä¿®æ”¹ï¼Œä¸€æ¬¡å†…å­˜æ“ä½œï¼›å¦‚æœè¯¥è®°å½•åœ¨Buffer Poolä¸­ä¸å­˜åœ¨ï¼ˆæ²¡æœ‰å‘½ä¸­ï¼‰ï¼Œä¼šç›´æ¥åœ¨Change Bufferè¿›è¡Œä¸€æ¬¡å†…å­˜æ“ä½œï¼Œä¸ç”¨å†å»ç£ç›˜æŸ¥è¯¢æ•°æ®ï¼Œé¿å…ä¸€æ¬¡ç£ç›˜IOï¼Œå½“ä¸‹æ¬¡æŸ¥è¯¢è®°å½•æ—¶ï¼Œä¼šå…ˆè¿›è¡Œç£ç›˜è¯»å–ï¼Œç„¶åå†ä»CBä¸­è¯»å–ä¿¡æ¯åˆå¹¶ï¼Œæœ€ç»ˆè½½å…¥Buffer Poolä¸­ã€‚

  > ã€æ³¨æ„ã€‘ï¼šå†™ç¼“å†²åŒºä»…é€‚ç”¨äºéå”¯ä¸€æ™®é€šç´¢å¼•é¡µï¼
  >
  > å¦‚æœç»™ç´¢å¼•è®¾ç½®å”¯ä¸€æ€§ï¼Œåœ¨è¿›è¡Œä¿®æ”¹æ—¶ï¼ŒInnoDBå¿…é¡»è¦åšå”¯ä¸€æ€§æ ¡éªŒï¼Œå› æ­¤å¿…é¡»æŸ¥è¯¢ç£ç›˜ï¼Œåšä¸€æ¬¡IOæ“ä½œã€‚å³ç›´æ¥å°†è®°å½•æŸ¥è¯¢åˆ°Buffer Poolä¸­ï¼Œå¹¶åœ¨BPä¸­ä¿®æ”¹ï¼Œè€Œä¸ä¼šåœ¨Change Bufferä¸­æ“ä½œã€‚

**Adaptive Hash Index**

è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œç”¨äºä¼˜åŒ–å¯¹BPæ•°æ®çš„æŸ¥è¯¢ã€‚InnoDBå­˜å‚¨å¼•æ“ä¼šç›‘æ§å¯¹è¡¨ä¸ŠäºŒçº§ç´¢å¼•ï¼ˆç´¢å¼•é¡µï¼‰çš„æŸ¥æ‰¾ï¼Œå¦‚æœå‘ç°æŸäºŒçº§ç´¢å¼•è¢«é¢‘ç¹è®¿é—®ï¼Œå»ºç«‹å“ˆå¸Œç´¢å¼•å¯ä»¥å¸¦æ¥é€Ÿåº¦çš„æå‡ï¼Œå°±ä¼šå»ºç«‹å“ˆå¸Œç´¢å¼•ï¼ˆkeyæ˜¯é¢‘ç¹è®¿é—®çš„ç´¢å¼•é”®å€¼ï¼Œvalueä¸ºè¯¥ç´¢å¼•é”®å€¼åŒ¹é…çš„å®Œæ•´è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µç¼–å·å’Œé¡µåç§»é‡ï¼‰ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºè‡ªé€‚åº”ï¼Œå³InnoDBå­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨æ ¹æ®è®¿é—®çš„é¢‘ç‡å’Œæ¨¡å¼ä¸ºæŸäº›æ•°æ®é¡µå»ºç«‹å“ˆå¸Œç´¢å¼•ã€‚

![image-20220110102832502](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220110102832502.png)

**Log Buffer**

æ—¥å¿—ç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜è¦å†™å…¥åˆ°ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶ï¼ˆRedo/Undo Logï¼‰çš„æ•°æ®ï¼Œæ—¥å¿—ç¼“å†²åŒºçš„å†…å®¹å®šæœŸåˆ·æ–°åˆ°ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚

+ Log Bufferä¸»è¦ç”¨äºè®°å½•DMLæ“ä½œæ—¶InnoDBå¼•æ“äº§ç”Ÿçš„Redoå’ŒUndoæ—¥å¿—ã€‚

+ Log Bufferç©ºé—´æ»¡äº†ï¼Œä¼šè‡ªåŠ¨åˆ·æ–°åˆ°ç£ç›˜ã€‚

+ å½“é‡åˆ°BLOBæˆ–å¤šè¡Œæ›´æ–°çš„å¤§äº‹åŠ¡æ“ä½œæ—¶ï¼Œé€šè¿‡å¢åŠ æ—¥å¿—ç¼“å†²åŒºï¼ˆinnodb_log_buffer_sizeï¼‰å¯ä»¥å‡å°‘ç£ç›˜IOã€‚

+ Innodb_flush_log_at_trx_commitå‚æ•°æ§åˆ¶æ—¥å¿—åˆ·æ–°è¡Œä¸ºï¼Œé»˜è®¤ä¸º1

  + 0ï¼šæ¯éš”1så†™æ—¥å¿—æ–‡ä»¶å’Œåˆ·ç›˜ï¼Œå³æœ€å¤šä¸¢å¤±1sæ•°æ®ï¼›
  + 1ï¼šäº‹åŠ¡æäº¤ï¼Œç«‹åˆ»å†™æ—¥å¿—æ–‡ä»¶å’Œåˆ·ç›˜ï¼Œæ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ˜¯ä¼šé¢‘ç¹IOæ“ä½œï¼›
  + 2ï¼šäº‹åŠ¡æäº¤ï¼Œç«‹åˆ»å†™æ—¥å¿—æ–‡ä»¶ï¼Œæ¯éš”1sè¿›è¡Œä¸€æ¬¡åˆ·ç›˜æ“ä½œ

  > æ³¨æ„ï¼šå†™æ—¥å¿—æ–‡ä»¶æŒ‡ä»Log Bufferåˆ°OS cacheï¼Œåˆ·ç›˜æŒ‡ä»OS cacheåˆ°ç£ç›˜æ–‡ä»¶ã€‚

##### InnoDBç£ç›˜ç»“æ„

InnoDBç£ç›˜ä¸»è¦åŒ…å«Tablespacesï¼ŒInnoDB Data Dictionaryï¼ŒDoublewrite Bufferï¼ŒRedo Logå’ŒUndo Logsã€‚

**è¡¨ç©ºé—´**ï¼ˆTablespacesï¼‰

+ ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆSystem Tablespaceï¼‰
+ ç‹¬ç«‹è¡¨ç©ºé—´ï¼ˆFile-Per-Table Tablespacesï¼‰
+ é€šç”¨è¡¨ç©ºé—´ï¼ˆGeneral Tablespacesï¼‰
+ æ’¤é”€è¡¨ç©ºé—´ï¼ˆUndo Tablespacesï¼‰
+ ä¸´æ—¶è¡¨ç©ºé—´ï¼ˆTemporary Tablespacesï¼‰

**æ•°æ®å­—å…¸**ï¼ˆInnoDB Data Dictionaryï¼‰

**åŒå†™ç¼“å†²åŒº**ï¼ˆDoublewrite Bufferï¼‰

**é‡åšæ—¥å¿—**ï¼ˆRedo Logï¼‰

**æ’¤é”€æ—¥å¿—**ï¼ˆUndo Logsï¼‰





##### æ–°ç‰ˆæœ¬ç»“æ„æ¼”å˜

![image-20220107185732954](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220107185732954.png)

#### InnoDBçº¿ç¨‹æ¨¡å‹

#### InnoDBæ•°æ®æ–‡ä»¶

![image-20220109200204005](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220109200204005.png)

![image-20220109200502486](https://cdn.jsdelivr.net/gh/YuanAaron/BlogImage/2021/image-20220109200502486.png)

#### Undo Log

#### Redo Logå’ŒBinlog

## MySQLç´¢å¼•åŸç†

### ç´¢å¼•ç±»å‹

### ç´¢å¼•åŸç†

### ç´¢å¼•åˆ†æä¸ä¼˜åŒ–

### æŸ¥è¯¢ä¼˜åŒ–

## MySQLäº‹åŠ¡å’Œé”

### ACIDç‰¹æ€§

### äº‹åŠ¡æ§åˆ¶çš„æ¼”è¿›

#### å¹¶å‘äº‹åŠ¡

#### æ’é˜Ÿ

#### æ’ä»–é”

#### è¯»å†™é”

#### MVCC

### äº‹åŠ¡éš”ç¦»çº§åˆ«

### é”æœºåˆ¶å’Œå®æˆ˜

## MySQLé›†ç¾¤æ¶æ„



