---
layout: post 
author: oshacker
title: Ubuntu18.04源码安装mysql-5.7.30
category: database
tags: [database,mysql]
excerpt: 搭建源码环境
---

## 安装依赖

```bash
sudo apt-get install cmake make gcc g++ openssl libssl-dev libncurses5-dev bison

以下为安装mysql5.7需要注意：
1. make建议3.75及以上
2. gcc要求4.4及以上
3. openssl要求1.0.1及以上
4. boost在https://www.boost.org/users/history/单独下载，要求使用1.59.0
5. bison要求2.1及以上
```

## 编译构建

```bash
# 进入源码目录
cd mysql-5.7.30

# 创建构建文件的目录及数据目录 以及boost目录
mkdir -p /home/oshacker/code/mysql-5.7.30/build_mysql/ /home/oshacker/code/mysql-5.7.30/build_mysql/data /home/oshacker/code/mysql-5.7.30/build_mysql/boost_1_59_0

cmake -DCMAKE_BUILD_TYPE=Debug \
-DCMAKE_INSTALL_PREFIX=/home/oshacker/code/mysql-5.7.30/build_mysql/ \
-DMYSQL_DATADIR=/home/oshacker/code/mysql-5.7.30/build_mysql/data \
-DMYSQL_UNIX_ADDR=/home/oshacker/code/mysql-5.7.30/build_mysql/mysql.sock  \
-DWITH_BOOST=/home/oshacker/code/mysql-5.7.30/build_mysql/boost_1_59_0 \
-DSYSCONFDIR=/home/oshacker/code/mysql-5.7.30/build_mysql/

# 构建
make
# 安装
make install
```

## 数据库初始化

进入/home/oshacker/code/mysql-5.7.30/build_mysql/下

```bash
#我这里直接使用root用户，如果创建mysql用户需要注意权限问题
bin/mysqld --initialize --user=root 
#不加密
#bin/mysqld --initialize-insecure

# 这一步是否必须不知道
bin/mysql_ssl_rsa_setup
```

## 启动停止MySQL

```bash
#服务端启动（方法一）
bin/mysqld --user=root

#使用原始密码登陆客户端
bin/mysql -uroot -p
#修改密码
alter user 'root'@'localhost' identified by 'root';

#服务端启动（方法二）
bin/mysqld_safe --user=root &
#服务端启动（方法三）
support-files/mysql.server start --user=root

#这两种关闭方法均适用于以上三种启动方法
support-files/mysql.server stop --user=root
bin/mysqladmin --user=root -p shutdown

#不推荐，有时会出现莫名其妙的问题，导致mysql起不来。
#如果非想这样做，先杀mysqld_safe进程（如果有的话），再杀mysqld进程，否则mysqld根本杀不死，前者会再调起后者
kill -9 
```

## 配置环境变量

打开/etc/profile，在末尾添加下面两行，然后source /etc/profile

```bash
export MYSQL_HOME=/home/oshacker/code/mysql-5.7.30/build_mysql/
export PATH=$MYSQL_HOME/bin:$MYSQL_HOME/support-files:$PATH
```

## 参考资料

[MySQL 5.7 编译调试指南(Ubuntu 16.04 + MacOS 10.15)](https://www.jianshu.com/p/5ede7715ae36)



